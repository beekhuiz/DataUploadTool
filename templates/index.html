<!DOCTYPE html>

<!-- Built with JQuery File Upload (https://github.com/blueimp/jQuery-File-Upload/) -->
<!-- Flask File Upload (https://github.com/ngoduykhanh/flask-file-uploader)  -->
<!-- Twitter's Bootstrap CSS framework(twitter.github.com/bootstrap/) -->
<!-- Icons from Glyphicons (http://glyphicons.com/) and font awesome (https://fortawesome.github.io/Font-Awesome/) -->

<html>
	<head>
		<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
		<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon"> 		

		<!-- CSS -->
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css">
		<link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.fileupload.css') }}">
		<link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.fileupload-ui.css') }}">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/css/bootstrap-dialog.min.css">
	
		<!-- Generic page styles -->
		<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">		

		
		<!-- JS -->
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
		
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
		<script src="{{url_for('static', filename='js/vendor/jquery.ui.widget.js')}}"></script>	
		<!-- <script src="static/js/vendor/jquery.ui.widget.js"></script> -->
		<!-- The Templates plugin is included to render the upload/download listings -->
		<script src="http://blueimp.github.io/JavaScript-Templates/js/tmpl.min.js"></script>
		<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->

		<script src="{{ url_for('static', filename='js/jquery.iframe-transport.js') }}"></script>
		<!-- The basic File Upload plugin -->
		<script src="{{ url_for('static', filename='js/jquery.fileupload.js') }}"></script>
		<!-- The File Upload processing plugin -->
		<script src="{{ url_for('static', filename='js/jquery.fileupload-process.js') }}"></script>
		<!-- The File Upload validation plugin -->
		<script src="{{ url_for('static', filename='js/jquery.fileupload-validate.js') }}"></script>
		<!-- The File Upload user interface plugin -->
		<script src="{{ url_for('static', filename='js/jquery.fileupload-ui.js') }}"></script>

		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/js/bootstrap-dialog.min.js"></script>

		<!-- The main application script -->
		<script src="{{ url_for('static', filename='js/main.js') }}"></script>
		<!-- The XDomainRequest Transport is included for cross-domain file deletion for IE 8 and IE 9 -->
		<!--[if (gte IE 8)&(lt IE 10)]>
		<script src="js/cors/jquery.xdr-transport.js"></script>
		<![endif]-->

	</head>
	<body>

		<div class="container">

			<div class="col-md-12">
				
				<div class="switchon-header">
					<span><img src="{{ url_for('static', filename='img/sologo_white.png')}}" alt=""/></span>
					<h1>Data Upload Tool</h1>
				</div>
							
				<!-- The messagebox on top of the panel with the contents. The message is set with javascript function   "setmessage" -->
				<div id="messagetype">
					<span id="messagefa"></span> 		
					<div id="messagetext"></div>			
				</div>						
				
				{% if fileupload == False %}					
					<script>
						var message = "Select the type of dataserver for storing the dataset. The dataset name should be as specific as possible and contain the variable and source of data (in that order). The dataset consists of one or more files that can be uploaded after creating the dataset folder.";
						setMessage("alert alert-success", "fa fa-4x fa-fw fa-pull-left fa-info-circle", message);			
					</script>	
	
					<form onsubmit="return validateForm()" class="form-horizontal" method="post" action='createdataset'>	
						<div class="panel panel-primary">
							<div class="panel-heading">
								Dataset Name
							</div>
							
							<div class="panel-body">
							
								<div class="form-group">
									<label for="radiobuttonsID" class="control-label col-sm-2">Store dataset on:</label>
									<div id="radiobuttonsID" class="col-sm-6 btn-group" data-toggle="buttons">
										<label id="regularserver" class="btn btn-default active">
											<input checked name="server" value="regular" checked type="radio" >File server
										</label>
										<label id="geoserver" class="btn btn-default disabled">
											<input name="server" value="geoserver" type="radio">Geoserver
										</label>
										<label id="thredds" class="btn btn-default disabled">
											<input name="server" value="thredds" type="radio">THREDDS
										</label>
									</div>
								</div>							
								
								<div class="form-group">
									<label class="control-label col-sm-2" for="datasetnameID">Dataset name:</label>
									<div class="col-sm-4">          
										<input type="text" class="form-control" name="datasetname" title="The name should describe the dataset as good as possible and is used to create a unique folder on the file server."
										id="datasetnameID" placeholder="Dataset" value="{{ datasetfolder }}">
									</div>						
								</div>
							</div>	<!-- End panel body -->
							
							<div class="panel-footer clearfix">								
								<button type="submit" id="nextID" name="submitButton" value="next" class="btn btn-primary pull-right">					
									Next	
								</button>
								<button type="button" id="previousID" name="submitButton" value="previous" class="btn btn-default pull-right">			
									Previous	<!-- EDIT: MAKE A SUBMIT BUTTON WITHOUT VALIDATEFORM -->
								</button>						
							</div>							
						
						</div>	 <!-- end panel-default -->
					</form>							
				{% endif %}	
				
				
				{% if fileupload == True %}					
						
					<script>
						var message = "Please upload the dataset files. You can drag & drop files from your desktop on this webpage or click on \"Add files..\" to browse your computer."
						setMessage("alert alert-success", "fa fa-4x fa-fw fa-pull-left fa-info-circle", message);			
					</script>						
						
					<div class="panel panel-primary">
						<div class="panel-heading">
							Upload files
						</div>						
						
						<div class="panel-body">
						
							<!-- The file upload form used as target for the file upload widget -->		
							<form id="fileupload" method="POST" enctype="multipart/form-data">	
								<!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->
								<div class="row fileupload-buttonbar">
									<div class="col-lg-7">
										<!-- The fileinput-button span is used to style the file input field as button -->
										<div class="btn btn-success fileinput-button">
											<i class="glyphicon glyphicon-plus"></i>
											<span>Add files...</span>
											<input type="file" name="file" multiple>
										</div>										
									</div>
								</div>	
										
								<br>
								
								<!-- The table listing the files available for upload/download -->
								<table role="presentation" class="table table-striped"><tbody class="files"></tbody></table>
								<input type="hidden" name="dataset" value="{{ datasetfolder }}">
							</form>	
						</div>
												
						<div class="panel-footer clearfix">						
							<form action="submitfiles" method="POST" class="form-inline">
								<input type="hidden" name="datasetname" id="datasetID" value="{{ datasetfolder}}">							
								<button type="submit" name="submitButton" value="next" class="btn btn-primary pull-right">								
									Next
								</button>
								<button type="submit" name="submitButton" value="previous" class="btn btn-default pull-right">							
									Previous
								</button>	
							</form>
						</div>					
					</div> <!-- End panel primary -->	
						
			{% endif %}		
			
			</div>	<!-- end Div col 12 -->
				
		</div> <!-- end div container -->	
		
		
		{% with messages = get_flashed_messages() %}
			{% if messages %}
			<ul class=flashes>
			{% for message in messages %}
				<script>
					setMessage("alert alert-warning", "fa fa-4x fa-fw fa-pull-left fa-exclamation-triangle", "{{ message }}");
										
				</script>				
			{% endfor %}
			</ul>
			{% endif %}
		{% endwith %} 
		
	</body>
</html>

{% raw %}
<!-- The template to display files available for upload -->
<script id="template-upload" type="text/x-tmpl">	
{% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-upload fade">
        <td>
            <p class="name">{%=file.name%}</p>
            <strong class="error text-danger"></strong>
        </td>
        <td>
            <p class="size">Processing...</p>
            <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="progress-bar progress-bar-success" style="width:0%;"></div></div>
        </td>
        <td>
            {% if (!i && !o.options.autoUpload) { %}
                <button class="btn btn-primary start" disabled>
                    <i class="glyphicon glyphicon-upload"></i>
                    <span>Start</span>
                </button>
            {% } %}
            {% if (!i) { %}
                <button class="btn btn-warning cancel">
                    <i class="glyphicon glyphicon-ban-circle"></i>
                    <span>Cancel</span>
                </button>
            {% } %}
        </td>
    </tr>
{% } %}

</script>
<!-- The template to display files available for download -->
<script id="template-download" type="text/x-tmpl">
{% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-download fade">
        <td>
            <p class="name">
                {% if (file.url) { %}
                    <a href="{%=file.url%}" title="{%=file.dataset%}\{%=file.name%}" download="{%=file.name%}">{%=file.dataset%}\{%=file.name%}</a>
                {% } else { %}
                    <span>{%=file.name%}</span>
                {% } %}
            </p>
            {% if (file.error) { %}
                <div><span class="label label-danger">Error</span> {%=file.error%}</div>
            {% } %}
        </td>
        <td>
            <span class="size">{%=o.formatFileSize(file.size)%}</span>
        </td>
    </tr>
{% } %}
</script>
{% endraw %}